---
title: 学习R for data science - 03 一些基础操作
author: 王强
date: '2017-09-29'
slug: r-for-data-science-03-some-basics
categories:
  - R
tags:
  - R
  - R basics
---

按照原书的结构，真的是先讲图形，又讲基础，据作者说是为了先激发兴趣。这里基于其[第四章](http://r4ds.had.co.nz/workflow-basics.html)，做一个汇总。但不局限于书中内容，而是通过自己踩过的坑，尽量先讲需求，再谈实现。

# 1. 需要安装的软件和需要了解的工具链

## 1.1 需要安装的软件

### R基础程序，从cran下载

R语言是一种语言，这种语言比较特殊，在设计之初就是为了统计而生的。这既是它的优势也是它的劣势。优势在于善于统计分析，劣势在于除了统计分析，你想干点别的，比如用它做个游戏玩就比较难以实现。

运行R语言需要下载一个安装包，要到其[官方网站](https://www.r-project.org/)去下载。

```{r echo = FALSE, out.width = "75%"}
knitr::include_graphics("/post/pic/01.png")
```



这就是R的官方网站，也就是开发R的core team放新版本，组织资源的地方。暂时不想了解太多的话，直接点击download R，就会出来一个列表。
```{r echo = FALSE, out.width = "75%"}
knitr::include_graphics("/post/pic/2017-09-29 10.00.58.png")
```

这个列表就是上一个页面左侧的cran（The Comprehensive R Archive Network），就是各个国家的服务器，用来放置R网站的镜像的（这样万一那个服务器受到损毁，不至于无处恢复），中国也有好几个。点进去，找到合适自己的版本下载就行了，不管是windows，mac，还是linux都有相应的版本。

安装了r基础程序后，打开以后是这个样子，这是控制台。
```{r echo = FALSE, out.width = "75%"}
knitr::include_graphics("/post/pic/2017-09-29 10.09.56.png")
```


其实现在就可以在里面敲打一些代码了，比如1+1。但实际工作中不可能一直在控制台里零敲碎打，需要把代码集中放到编辑器里，等到使用的时候再传给控制台去运行。R自带的编辑器是像下面这样的，这个场景就是在编辑器里写了几行代码，然后摁ctrl+enter（win），或command+return（mac），把代码送到控制台运行。

```{r echo = FALSE, out.width = "75%"}
knitr::include_graphics("/post/pic/2017-09-29 10.24.47.png")
```


但r自带的编辑器功能不是太多，比如我们想要代码高亮、自动补全，这些都没有，更别提直接代码和运行结果混合编辑，直接出pdf网页或word，甚至直接发布到网站了，所以我们还需要安装别的软件。

### rstudio，从rstudio公司网站下载

rstudio有编辑器的功能，但不止于此。到[官网](https://www.rstudio.com/)下载，从product里找Rstudio，然后找desktop（与sever对应），然后选free的就可以了。安装以后用起来大概是这样的：

```{r echo = FALSE, out.width = "75%"}
knitr::include_graphics("/post/pic/2017-09-29 10.33.54.png")
```

看看也能大概明白，左上角正在写的就是编辑区，Rstudio的好处在于可以文字和代码混编，比如我现在写的基本都是文字，需要插入代码的话，写个```{r}就可以了，结束了再写个```表示写完了。

这是需要表达的时候要掌握的内容，目前只需要知道，左上这一块是编辑器可以写代码，左下是控制台可以运行代码，右上是环境等等告诉你统计的过程中产生了哪些对象，右下是涉及的目录、文件、包等等告诉你用了什么包和存读了哪些文件。

## 1.2 接下来了解一串工具链

下载了软件，相当于准备好了主要工具，但在使用过程中还涉及一些其他内容，组成了一串工具链，主要包括不同的包和文档编写工具。

比如我分析了一点[白榆](http://www.ecology.wang/2017/09/23/%E4%BD%BF%E7%94%A8r%E8%AF%AD%E8%A8%80%E5%88%86%E6%9E%90%E7%99%BD%E6%A6%86%E7%94%9F%E9%95%BF%E6%95%B0%E6%8D%AE/)的数据。在这个简单的分析过程中，涉及整理、清洗、变形、统计、做图等多个环节，这就需要不同的包（package）。包是基于R语言开发的发挥特定功能的组件，如果说R是中央政府的话，包就是不同的职能部门，负责不同方面的业务。cran对其收编的包（为啥说收编呢，因为还有些不在cran里的）有按领域的归纳，叫[task view](https://mirrors.tuna.tsinghua.edu.cn/CRAN/)。这个挺好，多看看可以达到对业务领域和统计方法的相互促进。

还有github，为什么前面说收编的包，就是因为有很多包也精彩，但没编制，所以需要直接在github上下载。有些收编的包，其最新版也是在github上。这个暂时涉及不到，知道有这回事就好了。另外如果想做静态网站，也需要使用github，之前写了一个[使用jekyll做网站](http://www.ecology.wang/2016/08/27/how-to-jekyll-a-blog/)的流程，可以参考。

如果想把分析结果表达出来，还需要了解Rmarkdown，blogdown等内容，要稍微了解一点knitr的运作机制，不然的话出错不知道如何应对。

这些顺带一说，第一步只需要装好R和Rstudio，就可以进行一些基本操作了。

# 2. R 语言的一些基本操作

基本操作包括：

- 当做计算器，进行加减乘除等等。
- 赋值、读取数据
- 使用r语言自带的函数
- 加载特定包，使用包里的函数

## 2.1 当计算器进行运算

这个比较简单，运算符号在各种语言包括excel里都差不多。

```{r}
1 / 200 * 30

(59 + 73 + 2) / 3

sin(pi / 2)

```


## 2.2 赋值、读取数据

数据在r语言里以对象的形式存在，对象可以用=进行赋值，也可以用 -> 或者 <- 进行赋值，箭头冲哪儿就是把值赋给谁，不用在意左右。

```{r}
x <- 3 * 4

4^2 -> y
```

这里x，y就是数值对象。除了数值对象，还有向量型（vector），数据框（dataframe），以及数据串(list)等多种形式。Hadey最近还新创了一个tibble格式，实现了数据框中框。在实际分析中遇到最多的是数据框。比如我先把数据放在excel里，然后读进来，就成了一个数据框。

```{r}
my.data = read.csv("all.data.csv", header = T, row.names = 1)
head(my.data)
str(my.data)
summary(my.data)
```

以上是读取了一个整理好的csv文件，放到my.data这个对象中。header=T是说文件variable有标题，row.names=1是说第一列是每一行的名字。

下面的三个函数，分别查看my.data的前六行，结构，和数据大体情况。


## 2.3 使用r语言自带的函数

刚才已经涉及了几个r语言自带的函数了，关于函数的汇总可以查看[r-reference-card](https://cran.r-project.org/doc/contrib/Short-refcard.pdf)，一个经典的函数汇总表，这里还有[中文版](https://cran.r-project.org/doc/contrib/Liu-R-refcard.pdf)。

## 2.4 加载特定包，使用包里的函数

不同行业有各种各样不同的需求。比如生态学经常要做个排序、聚类啥的。如果从R的基本语句开始，也可以实现相应的需求，不过那样太难太复杂。所以就有牛人编写特定的函数，把常用的功能汇总成包，等需要用的时候，只需要载入包，调用函数就行了（比如vegan）。

比如我想把刚才导入的白榆，按品种求平均值。

```{r}
library(tidyverse)
my.data %>%
  group_by(spe) %>%
  summarise(high = mean(high),
          dbh = mean(dbh),
          ew = mean(ew),
          sn = mean(sn)) -> mean.data

mean.data
```

先载入了tidyverse包，然后使用里面的管道函数（%>%），按spe分组，然后求不同指标的平均值，然后把求得的结果赋给mean.data。

如果想做个主成分分析，则要导入另外的包。当然有很多包能做主成分分析，这里我们用生态研究最喜欢用的vegan。

```{r}
library(vegan)
plot(rda(mean.data[,-1]))
```

多么简单！

# 3. 一些学习资源

R是开源软件，学习资源太多了，需要解决的问题不是到哪里去找书找文章找代码，而是如何选一个相对合适角度和姿势，的然后持续的学下去。我的感觉是，最好能与自己的手头工作有所结合，`活学活用，急用先学`，如果学习能有比较明显的正向反馈，就会有更大概率坚持下去。当然对能利用的资源也要有一个概念，结合自己不多的经验梳理如下：

- google。在安装R语言时，选择英语，这样错误信息就可以放到google里搜索，基本自己遇到所有的问题，都有人遇到过了，而且提出了解决方案。当然你要能用google，我推荐[lantern](https://github.com/getlantern/forum)，装上以后买个专业版，支持支付宝，不多解释。

- [http://rseek.org/](http://rseek.org/)很不巧，这个也需要科学上网。它的作用是，不管你用什么关键词，都只会找到和r语言相关材料。比如我当年用它搜索微生物，然后出来个用r语言分析微生物多样性的网页，很受启发。

- 人大经济论坛。这个不放链接了搜一下吧。它的作用是。。。下盗版书。。。基本啥都有，但是需要论坛币，不过很便宜，我冲了五十块钱到现在没用完。

- 包的帮助，函数的帮助。比如想知道rda()的用法，打?rda即可。

- Coursera。里面有很多关于R语言和统计分析的课程。






